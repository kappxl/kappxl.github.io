"use strict";(self["webpackChunkfoodbase_app"]=self["webpackChunkfoodbase_app"]||[]).push([[587],{8833:(e,o,t)=>{t.r(o),t.d(o,{default:()=>I});var i=t(3673);const n={class:"flex flex-center"},a={class:"full-width column",style:{"max-width":"650px"}},d={class:"flex flex-center q-py-lg"};function s(e,o,t,s,l,r){const c=(0,i.up)("q-btn"),u=(0,i.up)("fb-header"),h=(0,i.up)("q-input"),m=(0,i.up)("q-card-section"),p=(0,i.up)("NutriDisplay"),g=(0,i.up)("MacroFoodList"),f=(0,i.up)("SIDialog"),y=(0,i.up)("q-spinner-tail"),w=(0,i.up)("q-inner-loading"),q=(0,i.up)("fb-bottom-actions"),b=(0,i.up)("fb-layout");return(0,i.wg)(),(0,i.j4)(b,null,{header:(0,i.w5)((()=>[(0,i.Wm)(u,{title:"Create Meal"},{left:(0,i.w5)((()=>[(0,i.Wm)(c,{round:"",icon:"arrow_back_ios",flat:"",color:"accent",size:"sm",rounded:"",onClick:o[0]||(o[0]=o=>e.$router.go(-1))})])),right:(0,i.w5)((()=>[e.id?((0,i.wg)(),(0,i.j4)(c,{key:0,round:"",icon:"delete",flat:"",class:"q-pr-md",color:"red",size:"md",rounded:"",onClick:e.deleteMeal},null,8,["onClick"])):((0,i.wg)(),(0,i.j4)(c,{key:1,flat:"",label:"save",onClick:e.storeMeal,color:"accent"},null,8,["onClick"]))])),_:1})])),footer:(0,i.w5)((()=>[(0,i.Wm)(q,{onCancel:o[4]||(o[4]=o=>e.$router.push({name:"food",params:{tabProp:"Meals"}})),onSave:e.storeMeal},null,8,["onSave"])])),default:(0,i.w5)((()=>[(0,i._)("div",n,[(0,i._)("div",a,[(0,i.Wm)(p,{food:e.ingredients},{bottom:(0,i.w5)((()=>[(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(m,{class:"column q-py-none"},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modelValue:e.foodName,"onUpdate:modelValue":o[1]||(o[1]=o=>e.foodName=o),label:"Name"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["food"]),(0,i.Wm)(g,{food:e.ingredients,onSelected:e.removeIngredient,onAdd:o[2]||(o[2]=o=>e.$refs.siDialog.open())},null,8,["food","onSelected"]),(0,i._)("div",d,[(0,i.Wm)(c,{size:"lg",round:"",color:"accent","text-color":"primary",icon:"add",onClick:o[3]||(o[3]=o=>e.$refs.siDialog.open())})])])]),(0,i.Wm)(f,{ref:"siDialog",onSelected:e.addIngredient},null,8,["onSelected"]),(0,i.Wm)(w,{showing:e.loading},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{size:"100px",color:"primary"})])),_:1},8,["showing"])])),_:1})}t(9544);var l=t(1959),r=t(952),c=t(7783);const u={class:"col q-pt-md q-px-md"},h={class:""};function m(e,o,t,n,a,d){const s=(0,i.up)("q-btn"),l=(0,i.up)("q-icon"),r=(0,i.up)("q-input"),c=(0,i.up)("MacroFoodList"),m=(0,i.up)("fb-bottom-dialog"),p=(0,i.up)("QtyDialog"),g=(0,i.up)("CIDialog");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(m,{back:"",title:"Select Ingredient",ref:"ingredientBottomDialog"},{right:(0,i.w5)((()=>[(0,i.Wm)(s,{onClick:o[0]||(o[0]=o=>e.$refs.ciDialog.open()),icon:"add",color:"accent",round:"",flat:""})])),default:(0,i.w5)((()=>[(0,i._)("div",u,[(0,i.Wm)(r,{rounded:"",outlined:"",dense:"",modelValue:e.search,"onUpdate:modelValue":o[1]||(o[1]=o=>e.search=o),placeholder:"Search ingredients",color:"accent",class:"full-width"},{append:(0,i.w5)((()=>[(0,i.Wm)(l,{name:"search"})])),_:1},8,["modelValue"])]),(0,i._)("div",h,[(0,i.Wm)(c,{food:e.ingredients,search:e.search,onSelected:e.chooseQty,type:"chart"},null,8,["food","search","onSelected"])])])),_:1},512),(0,i.Wm)(p,{ref:"qtyDialog",food:e.selectedFood,onSave:e.addFood},null,8,["food","onSave"]),(0,i.Wm)(g,{ref:"ciDialog",onCreated:e.fetchData},null,8,["onCreated"])])}var p=t(6192),g=t(9266),f=t(3152);const y=(0,i.aZ)({components:{MacroFoodList:c.Z,QtyDialog:p.Z,CIDialog:g.Z},setup(){return{search:(0,l.iH)(""),ingredients:(0,l.iH)([]),selectedFood:(0,l.iH)({})}},created(){this.fetchData()},methods:{open(){this.$refs.ingredientBottomDialog.open()},close(){this.$refs.ingredientBottomDialog.close()},fetchData(){(0,f.getIngredients)().then((e=>{this.ingredients=e}))},addFood(e){this.search="",this.$emit("selected",e),this.close()},chooseQty(e){this.selectedFood=e,this.$refs.qtyDialog.open()}}});var w=t(4260),q=t(4607),b=t(5641),D=t(4554),v=t(7518),$=t.n(v);const W=(0,w.Z)(y,[["render",m]]),M=W;$()(y,"components",{QBtn:q.Z,QInput:b.Z,QIcon:D.Z});const C=(0,i.aZ)({name:"CreateMeal",components:{NutriDisplay:r.Z,MacroFoodList:c.Z,SIDialog:M},props:{id:{type:String,default:null}},setup(){return{loading:(0,l.iH)(!1),ingredients:(0,l.iH)([]),foodName:(0,l.iH)("")}},mounted(){this.id&&this.getMeal(this.id)},methods:{deleteMeal(){this.id&&(this.loading=!0,(0,f.deleteFood)({id:this.id}).then((()=>{this.$router.push({name:"food",params:{tabProp:"Meals"}}),this.$q.notify({type:"good",message:`"${this.foodName}" deleted!`})})).catch((e=>{this.$q.notify({type:"bad",message:`Failed to delete "${this.foodName}"!`})})).finally((()=>this.loading=!1)))},getMeal(e){this.loading=!0,(0,f.getFood)({id:e}).then((e=>{this.foodName=e.name,this.ingredients=e.ingredients})).finally((()=>this.loading=!1))},addIngredient(e){let o=this.ingredients.find((o=>o.id===e.id));o?o.quantity+=e.quantity:this.ingredients.push(e)},removeIngredient(e){this.ingredients=this.ingredients.filter((o=>!(o.id===e.id)))},storeMeal(){""===this.foodName?this.$q.notify({type:"warning",message:"Name is required."}):this.ingredients.length<1?this.$q.notify({type:"warning",message:"Min. 1 ingredient is required."}):(0,f.saveMeal)({id:this.id,name:this.foodName,user:"foodbase",ingredients:this.ingredients}).then((()=>{this.$router.push({name:"food",params:{tabProp:"Meals"}}),this.$q.notify({type:"good",message:`"${this.foodName}" saved!`})})).catch((e=>{this.$q.notify({type:"bad",message:`Failed to save "${this.foodName}"!`})}))}}});var S=t(5589),Z=t(6941),_=t(682);const k=(0,w.Z)(C,[["render",s]]),I=k;$()(C,"components",{QBtn:q.Z,QCardSection:S.Z,QInput:b.Z,QInnerLoading:Z.Z,QSpinnerTail:_.Z})}}]);