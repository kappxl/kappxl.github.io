(self["webpackChunkfoodbase_app"]=self["webpackChunkfoodbase_app"]||[]).push([[264],{9818:(e,t,o)=>{const a=o(52),n=async({searchterm:e,page:t=1,page_size:o=20})=>e&&""!==e?a({url:`https://de.openfoodfacts.org/cgi/search.pl?action=process&search_terms=${e}&sort_by=unique_scans_n&page_size=${o}&page=${t}&nocache=1&json=1`,method:"get"}):{data:{products:[]}};e.exports={searchProducts:n}},7492:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>K});var a=o(3673);const n={class:"flex flex-center"};function i(e,t,o,i,s,l){const r=(0,a.up)("q-tab"),d=(0,a.up)("q-tabs"),c=(0,a.up)("fb-header"),g=(0,a.up)("q-spinner-ios"),u=(0,a.up)("q-icon"),p=(0,a.up)("q-input"),h=(0,a.up)("Categories"),m=(0,a.up)("q-tab-panel"),f=(0,a.up)("Foodlist"),y=(0,a.up)("q-tab-panels"),C=(0,a.up)("q-fab-action"),b=(0,a.up)("q-fab"),w=(0,a.up)("q-page-sticky"),F=(0,a.up)("q-btn"),q=(0,a.up)("q-spinner-tail"),_=(0,a.up)("q-inner-loading"),k=(0,a.up)("CIDialog");return(0,a.wg)(),(0,a.iD)("div",n,[(0,a._)("div",{onClick:t[6]||(t[6]=t=>e.createButton=!1),class:"col",style:{"max-width":"650px"}},[(0,a.Wm)(c,{custom:""},{content:(0,a.w5)((()=>[(0,a.Wm)(d,{modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=t=>e.tab=t),class:"q-pa-none q-ma-none full-width bg-header text-accent",align:"justify","narrow-indicator":""},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{name:"Categories",label:"Categories"}),(0,a.Wm)(r,{name:"Meals",label:"Meals"}),(0,a.Wm)(r,{name:"Ingredients",label:"Ingredients"})])),_:1},8,["modelValue"])])),_:1}),(0,a._)("div",null,[e.searchVisible?((0,a.wg)(),(0,a.j4)(p,{key:0,rounded:"",outlined:"",dense:"",class:"q-px-lg q-pt-md",modelValue:e.search,"onUpdate:modelValue":t[2]||(t[2]=t=>e.search=t),placeholder:"Search",color:"accent"},{append:(0,a.w5)((()=>[e.loadOnlineFood?((0,a.wg)(),(0,a.j4)(g,{key:0,class:"q-pr-sm",color:"accent",size:"md"})):(0,a.kq)("",!0),""!==e.search?((0,a.wg)(),(0,a.j4)(u,{key:1,name:"close",onClick:t[1]||(t[1]=t=>e.search=""),class:"cursor-pointer",color:"accent"})):(0,a.kq)("",!0),(0,a.Wm)(u,{name:"search",color:"accent"})])),_:1},8,["modelValue"])):(0,a.kq)("",!0),e.loading?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(y,{key:1,modelValue:e.tab,"onUpdate:modelValue":t[5]||(t[5]=t=>e.tab=t),animated:"",swipeable:"",style:{"background-color":"#0000"}},{default:(0,a.w5)((()=>[(0,a.Wm)(m,{name:"Categories",class:"q-py-md q-px-none"},{default:(0,a.w5)((()=>[(0,a.Wm)(h,{categories:e.allCategories,onUpdate:e.fetchData},null,8,["categories","onUpdate"])])),_:1}),(0,a.Wm)(m,{name:"Meals",class:"q-pa-none"},{default:(0,a.w5)((()=>[(0,a.Wm)(f,{search:e.search,food:e.sortedMeals,onUpdate:e.fetchData,onClickonempty:t[3]||(t[3]=t=>e.goToCreatePage("meal"))},null,8,["search","food","onUpdate"])])),_:1}),(0,a.Wm)(m,{name:"Ingredients",class:"q-pa-none"},{default:(0,a.w5)((()=>[(0,a.Wm)(f,{search:e.search,food:e.sortedIngredients,onUpdate:e.fetchData,onClickonempty:t[4]||(t[4]=t=>e.goToCreatePage("ingredient"))},null,8,["search","food","onUpdate"])])),_:1})])),_:1},8,["modelValue"]))])]),(0,a.Wm)(w,{position:"bottom-right",offset:[18,18]},{default:(0,a.w5)((()=>[(0,a.Wm)(b,{modelValue:e.createButton,"onUpdate:modelValue":t[11]||(t[11]=t=>e.createButton=t),"vertical-actions-align":"right",color:"accent",icon:"add","text-color":"primary",direction:"up",persistent:!1},{default:(0,a.w5)((()=>[(0,a.Wm)(C,{"label-position":"right",color:"accent","text-color":"primary",icon:"lunch_dining",label:"Create Meal",onClick:t[7]||(t[7]=t=>e.goToCreatePage("meal"))}),(0,a.Wm)(C,{"label-position":"right",color:"accent","text-color":"primary",icon:"add_circle_outline",label:"Create Ingredient",onClick:t[8]||(t[8]=t=>e.goToCreatePage("ingredient"))}),(0,a.Wm)(C,{"label-position":"right",color:"accent","text-color":"primary",icon:"category",label:"Create Category",onClick:t[9]||(t[9]=t=>e.goToCreatePage("category"))}),(0,a.Wm)(C,{"label-position":"right",color:"accent","text-color":"primary",icon:"qr_code_scanner",label:"Scan Product",onClick:t[10]||(t[10]=t=>e.$router.push({name:"barcodereader"}))})])),_:1},8,["modelValue"])])),_:1}),e.showScanBtn?((0,a.wg)(),(0,a.j4)(w,{key:0,position:"bottom-left",offset:[18,18]},{default:(0,a.w5)((()=>[(0,a.Wm)(F,{round:"",color:"accent","text-color":"primary",size:"lg",icon:"qr_code_scanner",onClick:t[12]||(t[12]=t=>e.$router.push({name:"barcodereader"}))})])),_:1})):(0,a.kq)("",!0),(0,a.Wm)(_,{showing:e.loading},{default:(0,a.w5)((()=>[(0,a.Wm)(q,{size:"100px",color:"primary"})])),_:1},8,["showing"]),(0,a.Wm)(k,{dialogModel:e.dialogCIStatus,onCreated:e.onIngredientCreated},null,8,["dialogModel","onCreated"])])}o(71);var s=o(1959);function l(e,t,o,n,i,s){const l=(0,a.up)("MacroFoodList"),r=(0,a.up)("DetailsDialog"),d=(0,a.up)("QuantityDialog");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("div",null,[(0,a.Wm)(l,{search:e.search,food:e.food,type:"chart",onSelected:e.showDetails,onAdd:t[0]||(t[0]=t=>e.$emit("clickonempty"))},null,8,["search","food","onSelected"])]),(0,a.Wm)(r,{edit:"",ref:"foodDetails",food:e.selectedFood,onAdd:e.openQuantityDialog,onDelete:e.onDelete,onEdit:e.editFood},null,8,["food","onAdd","onDelete","onEdit"]),(0,a.Wm)(d,{ref:"qtyDialog",food:e.selectedFood,onSave:e.addFood},null,8,["food","onSave"])])}var r=o(7783),d=o(7136),c=o(6192),g=o(3152),u=o(2221),p=o(1897),h=o(7691);const m=(0,a.aZ)({name:"Foodlist",components:{MacroFoodList:r.Z,DetailsDialog:d.Z,QuantityDialog:c.Z},props:{removeonly:{type:Boolean,default:!1},search:String,food:{type:Array,default:()=>[]}},setup(){return{selectedFood:(0,s.iH)(null)}},methods:{editFood(){this.selectedFood&&this.selectedFood.type&&this.selectedFood.id&&this.$router.push({name:this.selectedFood.type,params:{id:this.selectedFood.id}})},openQuantityDialog(){this.$refs.qtyDialog.open()},showDetails(e){this.selectedFood=e,this.$refs.foodDetails.open()},onDelete(e){!1===this.removeonly?this.deleteFood(e):this.$emit("remove",this.selectedFood)},deleteFood(e){(0,g.deleteFoodByType)(e).then((()=>{this.$emit("update")})).catch((e=>console.log(e)))},addFood(e){let t=(0,h.dayToStorageDate)((0,p.getSelectedDay)());(0,u.addFoodToDay)({storageDay:t,food:e,quantity:e.quantity}),this.$refs.foodDetails.close(),this.$router.push({name:"home"})}}});var f=o(4260);const y=(0,f.Z)(m,[["render",l]]),C=y;o(2100);var b=o(2323);const w={key:0},F={key:0},q={key:1,class:"q-pa-md"},_={key:1},k={class:"q-pb-md q-px-md no-wrap row justify-center items-center"};function D(e,t,o,n,i,s){const l=(0,a.up)("CategoryGrid"),r=(0,a.up)("EmptyListEntry"),d=(0,a.up)("q-btn"),c=(0,a.up)("Foodlist"),g=(0,a.up)("q-spinner-tail"),u=(0,a.up)("q-inner-loading");return(0,a.wg)(),(0,a.iD)("div",null,[null===e.selectedCat?((0,a.wg)(),(0,a.iD)("div",w,[e.categories&&e.categories.length>0?((0,a.wg)(),(0,a.iD)("div",F,[(0,a.Wm)(l,{items:e.categories,onSelected:e.setCategroy},null,8,["items","onSelected"])])):((0,a.wg)(),(0,a.iD)("div",q,[(0,a.Wm)(r,{long:"",msg:"Create Category",onClick:t[0]||(t[0]=t=>e.$router.push({name:"category"}))})]))])):((0,a.wg)(),(0,a.iD)("div",_,[(0,a._)("div",k,[(0,a.Wm)(d,{round:"",flat:"",color:"grey-8",icon:"arrow_back_ios",onClick:t[1]||(t[1]=t=>e.selectedCat=null)}),(0,a._)("div",{class:(0,b.C_)(["q-px-md q-py-sm text-h5 hide-overflow cat-header-title",`cat-${e.selectedCat.color}`]),onClick:t[2]||(t[2]=t=>e.$router.push({name:"category",params:{cat:JSON.stringify(e.selectedCat)}}))},(0,b.zw)(e.selectedCat.name),3),(0,a.Wm)(d,{round:"",color:"red",flat:"",icon:"delete",onClick:e.deleteSelectedCategroy},null,8,["onClick"])]),(0,a.Wm)(c,{removeonly:"",food:e.foodFromCat,onUpdate:t[3]||(t[3]=t=>e.$emit("update")),onRemove:e.deleteFoodFromCat,onClickonempty:t[4]||(t[4]=t=>e.$router.push({name:"category",params:{cat:JSON.stringify(e.selectedCat)}}))},null,8,["food","onRemove"])])),(0,a.Wm)(u,{showing:e.loading},{default:(0,a.w5)((()=>[(0,a.Wm)(g,{size:"100px",color:"primary"})])),_:1},8,["showing"])])}o(9544);var I=o(5350),v=o(3372),W=o(3448);const Z=(0,a.aZ)({name:"Categories",components:{CategoryGrid:I.Z,Foodlist:C,EmptyListEntry:v.Z},props:{categories:{type:Array,default:()=>[]}},setup(){return{loading:(0,s.iH)(!1),selectedCat:(0,s.iH)(null),foodFromCat:(0,s.iH)(null)}},methods:{setCategroy(e){this.loading=!0,(0,g.getFoodByIds)(e.foodIds).then((t=>{this.foodFromCat=t,this.selectedCat=e})).finally((()=>this.loading=!1))},deleteSelectedCategroy(){this.loading=!0,(0,W.deleteCategoryById)(this.selectedCat.id).then((()=>{this.selectedCat=null,this.$emit("update")})).finally((()=>this.loading=!1))},deleteFoodFromCat(e){this.loading=!0,this.loading=!1}},watch:{categories:{deep:!0,handler(){if(null!==this.selectedCat){let e=this.categories.find((e=>e.id===this.selectedCat.id));e&&this.setCategroy(e)}}}}});var S=o(4607),T=o(6941),Q=o(682),H=o(7518),$=o.n(H);const x=(0,f.Z)(Z,[["render",D]]),P=x;$()(Z,"components",{QBtn:S.Z,QInnerLoading:T.Z,QSpinnerTail:Q.Z});var V=o(9266),M=o(9818);const B=(0,a.aZ)({name:"FoodlistPage",props:{tabProp:{type:String,default:void 0}},components:{Foodlist:C,Categories:P,CIDialog:V.Z},setup(){return{loading:(0,s.iH)(!1),loadOnlineFood:(0,s.iH)(!1),search:(0,s.iH)(""),searchVisible:(0,s.iH)(!1),tab:(0,s.iH)("Ingredients"),allMeals:(0,s.iH)([]),ingredientsOof:(0,s.iH)([]),allIngredients:(0,s.iH)([]),localIngredients:(0,s.iH)([]),allCategories:(0,s.iH)([]),selectedFood:(0,s.iH)(null),createButton:(0,s.iH)(!1),dialogCIStatus:(0,s.iH)(!1),detailsDialog:(0,s.iH)(!1),dialogQtyStatus:(0,s.iH)(!1),delayTimer:(0,s.iH)(null)}},computed:{sortedIngredients(){let e=this.allIngredients;return e.sort(((e,t)=>e.name>t.name?1:t.name>e.name?-1:0))},sortedMeals(){let e=this.allMeals;return e.sort(((e,t)=>e.name>t.name?1:t.name>e.name?-1:0))},showScanBtn(){return(0,p.scanBtn)()}},mounted(){this.fetchData(),this.tab=this.tabProp||"Categories",this.searchVisible="Categories"!==this.tab},methods:{setIngredients(e){this.ingredientsOof=e},startLoading(){this.loadOnlineFood=!0},stopLoading(){this.loadOnlineFood=!1},getProducts(e,t,o){clearTimeout(this.delayTimer),this.delayTimer=setTimeout((function(a){var n=[];t(),(0,M.searchProducts)({searchterm:a,page:1,page_size:20}).then((t=>{t.data.products.length>0&&(n=t.data.products.map((e=>{let t;try{t={name:e.product_name||"",type:"oof",user:"foodbase",brand:e.brands||null,macros:{kcal:e.nutriments["energy-kcal_100g"],protein:e.nutriments["proteins_100g"],carbs:e.nutriments["carbohydrates_100g"],fat:e.nutriments["fat_100g"]}}}catch(o){t=null}return t})).filter((e=>null!==e&&""!==e.name))),e(n),o()})).catch((t=>{e([]),o(),console.log(t)}))}),500,this.search)},onIngredientCreated(){this.tab="Ingredients",this.fetchData()},goToCreatePage(e){this.$router.push({name:e})},fetchData(){(0,W.getCategories)().then((e=>this.allCategories=e)),(0,g.getMeals)().then((e=>this.allMeals=e)),(0,g.getIngredients)().then((e=>this.localIngredients=e))},setAllIngredients(){this.allIngredients=[...this.localIngredients,...this.ingredientsOof]},resetOnlineFood(){this.ingredientsOof=[]}},watch:{ingredientsOof:{deep:!0,handler(){this.setAllIngredients()}},localIngredients:{deep:!0,handler(){this.setAllIngredients()}},tab(e){this.search="",clearTimeout(this.delayTimer),this.stopLoading(),this.resetOnlineFood(),this.searchVisible="Categories"!==e},search(){"Ingredients"===this.tab&&!1!==(0,p.getSettings)().data.openfoodfacts&&this.getProducts(this.setIngredients,this.startLoading,this.stopLoading)}}});var O=o(2496),L=o(8408),U=o(5641),A=o(8506),j=o(4554),z=o(5906),E=o(6602),G=o(1007),J=o(9200),N=o(9975);const R=(0,f.Z)(B,[["render",i]]),K=R;$()(B,"components",{QTabs:O.Z,QTab:L.Z,QInput:U.Z,QSpinnerIos:A.Z,QIcon:j.Z,QTabPanels:z.Z,QTabPanel:E.Z,QPageSticky:G.Z,QFab:J.Z,QFabAction:N.Z,QBtn:S.Z,QInnerLoading:T.Z,QSpinnerTail:Q.Z})}}]);