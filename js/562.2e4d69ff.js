(self["webpackChunkfoodbase_app"]=self["webpackChunkfoodbase_app"]||[]).push([[562],{4771:(t,e,n)=>{const r=n(52),s=async t=>r({url:`https://world.openfoodfacts.org/api/v0/product/${t}.json`,method:"get"});t.exports={getProductByBarcode:s}},6562:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>$});var r=n(3673),s=n(2323);const a={class:"layer2 q-pa-lg row justify-center items-end"},o={class:"chip bg-primary row justify-center items-center"},i={key:0},c=(0,r._)("span",null,"Loading product...",-1),d={key:1,class:"text-center"};function u(t,e,n,u,l,h){const p=(0,r.up)("QRCodeReader"),g=(0,r.up)("q-spinner-ios"),m=(0,r.up)("q-page");return(0,r.wg)(),(0,r.j4)(m,{class:"bg-black container"},{default:(0,r.w5)((()=>[(0,r.Wm)(p,{onResult:t.loadProduct,onReady:t.scannerReady,onError:t.scannerError,class:"layer1"},null,8,["onResult","onReady","onError"]),(0,r._)("div",a,[(0,r._)("div",o,[t.loading?((0,r.wg)(),(0,r.iD)("div",i,[(0,r.Wm)(g,{class:"q-pr-sm",color:t.$q.dark.isActive?"black":"white",size:"1.85em"},null,8,["color"]),c])):((0,r.wg)(),(0,r.iD)("div",d,[(0,r._)("span",null,(0,s.zw)(t.scannerStatus),1)]))])])])),_:1})}n(2100);var l=n(1959);const h={class:"column justify-center"},p=(0,r._)("div",{id:"reader",class:"bg-black"},null,-1),g=[p];function m(t,e,n,s,a,o){return(0,r.wg)(),(0,r.iD)("div",h,g)}var y=n(4105);const f=(0,r.aZ)({setup(){return{cameras:(0,l.iH)([]),scanner:(0,l.iH)(null)}},unmounted(){this.stopScanner()},mounted(){this.scanner=new y.t2("reader"),this.startScanner()},methods:{startScanner(){try{this.scanner.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},this.onSuccess).then((()=>{this.$emit("ready")})).catch((t=>{this.$emit("ready")}))}catch(t){this.$emit("error")}},stopScanner(){try{this.scanner.stop().then((t=>{}))}catch(t){return}},onSuccess(t,e){this.$emit("result",t)}}});var b=n(4260);const S=(0,b.Z)(f,[["render",m]]),_=S;var v=n(4771);const w=(0,r.aZ)({name:"BarcodeReaderPage",components:{QRCodeReader:_},setup(){return{scannerStatus:(0,l.iH)("Setting up..."),loading:(0,l.iH)(!1),barcode:(0,l.iH)(null)}},methods:{scannerReady(){this.scannerStatus="Scanning..."},scannerError(){this.scannerStatus="Failed to load camera!"},loadProduct(t){this.loading||(this.loading=!0,this.barcode=t,(0,v.getProductByBarcode)(t).then((e=>{if(console.log(JSON.stringify(e)),1!==e.data.status)this.scannerStatus=t+": Product not found.";else{let n=e.data.product;if(0===Object.keys(n.nutriments).length)return this.scannerStatus=t+": Product not found.",void(this.loading=!1);this.scannerStatus="Please wait...";let r={name:n.product_name||"",kcal:n.nutriments["energy-kcal_100g"]?parseFloat(n.nutriments["energy-kcal_100g"].toFixed(1)):0,protein:n.nutriments["proteins_100g"]?parseFloat(n.nutriments["proteins_100g"].toFixed(1)):0,carbs:n.nutriments["carbohydrates_100g"]?parseFloat(n.nutriments["carbohydrates_100g"].toFixed(1)):0,fat:n.nutriments["fat_100g"]?parseFloat(n.nutriments["fat_100g"].toFixed(1)):0};this.$router.push({name:"ingredient",params:r})}this.loading=!1})).catch((t=>{console.log(t),this.loading=!1})))}}});var k=n(4379),R=n(8506),F=n(7518),P=n.n(F);const x=(0,b.Z)(w,[["render",u]]),$=x;P()(w,"components",{QPage:k.Z,QSpinnerIos:R.Z})}}]);